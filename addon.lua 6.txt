-- Anti-AFK Script with Custom GUI for Roblox
-- Updated: Outer circle size 20, fix lag toggle working properly

local player = game.Players.LocalPlayer
local gui = Instance.new("ScreenGui")
gui.Parent = player:WaitForChild("PlayerGui")
gui.Name = "AntiAFKGui"
gui.ResetOnSpawn = false

-- Outer Circular Button (to h∆°n = 20)
local outerButton = Instance.new("ImageButton")
outerButton.Size = UDim2.new(0, 20, 0, 20)  -- Size 20
outerButton.Position = UDim2.new(0.5, -10, 0.5, -10)  -- Center
outerButton.BackgroundColor3 = Color3.fromRGB(200, 200, 255)
outerButton.BackgroundTransparency = 0.4
outerButton.BorderSizePixel = 0
outerButton.AutoButtonColor = false
outerButton.Parent = gui

local outerCorner = Instance.new("UICorner")
outerCorner.CornerRadius = UDim.new(1, 0)  -- tr√≤n ho√†n to√†n
outerCorner.Parent = outerButton

-- Inner Menu (Frame vu√¥ng bo g√≥c)
local innerMenu = Instance.new("Frame")
innerMenu.Size = UDim2.new(0, 220, 0, 320)
innerMenu.Position = UDim2.new(0.5, -110, 0.5, -160)
innerMenu.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
innerMenu.BackgroundTransparency = 0.15
innerMenu.Visible = false
innerMenu.Parent = gui

local innerCorner = Instance.new("UICorner")
innerCorner.CornerRadius = UDim.new(0, 20)
innerCorner.Parent = innerMenu

-- Title
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "treo ti·ªÅn c√°i ü¶ãü´ôüêøÔ∏è"
titleLabel.TextColor3 = Color3.fromRGB(220, 220, 255)
titleLabel.TextSize = 22
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.Parent = innerMenu

-- Countdown Frame
local countdownFrame = Instance.new("Frame")
countdownFrame.Size = UDim2.new(0.8, 0, 0, 45)
countdownFrame.Position = UDim2.new(0.1, 0, 0.18, 0)
countdownFrame.BackgroundColor3 = Color3.fromRGB(90, 90, 120)
countdownFrame.Parent = innerMenu

local cdCorner = Instance.new("UICorner")
cdCorner.CornerRadius = UDim.new(0, 8)
cdCorner.Parent = countdownFrame

local countdownLabel = Instance.new("TextLabel")
countdownLabel.Size = UDim2.new(1, 0, 1, 0)
countdownLabel.BackgroundTransparency = 1
countdownLabel.TextColor3 = Color3.fromRGB(255, 240, 180)
countdownLabel.TextSize = 24
countdownLabel.Text = "380"
countdownLabel.Parent = countdownFrame

-- Minutes Frame
local minutesFrame = Instance.new("Frame")
minutesFrame.Size = UDim2.new(0.8, 0, 0, 35)
minutesFrame.Position = UDim2.new(0.1, 0, 0.32, 0)
minutesFrame.BackgroundColor3 = Color3.fromRGB(120, 120, 150)
minutesFrame.Parent = innerMenu

local minLabel = Instance.new("TextLabel")
minLabel.Size = UDim2.new(1, 0, 1, 0)
minLabel.BackgroundTransparency = 1
minLabel.TextColor3 = Color3.fromRGB(255, 255, 200)
minLabel.TextSize = 20
minLabel.Text = "Ph√∫t treo: 0"
minLabel.Parent = minutesFrame

-- FPS Label
local fpsLabel = Instance.new("TextLabel")
fpsLabel.Size = UDim2.new(1, 0, 0, 30)
fpsLabel.Position = UDim2.new(0, 0, 0.42, 0)
fpsLabel.BackgroundTransparency = 1
fpsLabel.TextColor3 = Color3.fromRGB(180, 255, 180)
fpsLabel.TextSize = 18
fpsLabel.Text = "FPS: Calculating..."
fpsLabel.Parent = innerMenu

-- Lag Fix Toggle
local lagToggleFrame = Instance.new("TextButton")  -- D√πng TextButton ƒë·ªÉ d·ªÖ click h∆°n
lagToggleFrame.Size = UDim2.new(0.8, 0, 0, 40)
lagToggleFrame.Position = UDim2.new(0.1, 0, 0.52, 0)
lagToggleFrame.BackgroundColor3 = Color3.fromRGB(0, 200, 80)   -- xanh = off
lagToggleFrame.TextColor3 = Color3.fromRGB(0, 0, 0)
lagToggleFrame.Text = "Fix Lag: Off"
lagToggleFrame.TextSize = 20
lagToggleFrame.Font = Enum.Font.SourceSansSemibold
lagToggleFrame.Parent = innerMenu

local lagCorner = Instance.new("UICorner")
lagCorner.CornerRadius = UDim.new(0, 10)
lagCorner.Parent = lagToggleFrame

local lagEnabled = false

-- L∆∞u setting g·ªëc ƒë·ªÉ reset
local originalSettings = {
    QualityLevel = settings().Rendering.QualityLevel,
    Brightness = game.Lighting.Brightness,
    GlobalShadows = game.Lighting.GlobalShadows,
    Technology = game.Lighting.Technology,
    FogEnd = game.Lighting.FogEnd,
    FOV = workspace.CurrentCamera.FieldOfView,
}

-- H√†m k√©o th·∫£ (draggable)
local function makeDraggable(frame)
    local dragging, dragInput, dragStart, startPos
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

makeDraggable(outerButton)
makeDraggable(innerMenu)

-- Toggle menu khi b·∫•m v√≤ng tr√≤n ngo√†i
outerButton.MouseButton1Click:Connect(function()
    innerMenu.Visible = not innerMenu.Visible
end)

-- Toggle Fix Lag (s·ª≠a l·ªói toggle kh√¥ng ho·∫°t ƒë·ªông)
lagToggleFrame.MouseButton1Click:Connect(function()
    lagEnabled = not lagEnabled
    
    if lagEnabled then
        lagToggleFrame.BackgroundColor3 = Color3.fromRGB(220, 40, 40)   -- ƒë·ªè = on
        lagToggleFrame.Text = "Fix Lag: On"
        
        -- √Åp d·ª•ng fix lag m·∫°nh
        settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
        game.Lighting.Brightness = 1
        game.Lighting.GlobalShadows = false
        game.Lighting.Technology = Enum.Technology.Compatibility
        game.Lighting.FogEnd = math.huge
        workspace.CurrentCamera.FieldOfView = 55
        
        -- T·∫Øt particle, trail, beam...
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") then
                v.Enabled = false
            end
        end
    else
        lagToggleFrame.BackgroundColor3 = Color3.fromRGB(0, 200, 80)   -- xanh = off
        lagToggleFrame.Text = "Fix Lag: Off"
        
        -- Reset v·ªÅ g·ªëc
        settings().Rendering.QualityLevel = originalSettings.QualityLevel
        game.Lighting.Brightness = originalSettings.Brightness
        game.Lighting.GlobalShadows = originalSettings.GlobalShadows
        game.Lighting.Technology = originalSettings.Technology
        game.Lighting.FogEnd = originalSettings.FogEnd
        workspace.CurrentCamera.FieldOfView = originalSettings.FOV
        
        -- B·∫≠t l·∫°i effect
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") then
                v.Enabled = true
            end
        end
    end
end)

-- Timer + FPS
local countdown = 380
local totalMinutes = 0

game:GetService("RunService").Heartbeat:Connect(function(dt)
    local fps = math.floor(1 / dt + 0.5)
    fpsLabel.Text = "FPS: " .. fps
    
    countdown = countdown - dt
    countdownLabel.Text = math.floor(countdown)
    
    if countdown <= 0 then
        countdown = 380
        totalMinutes = totalMinutes + 6  -- 380 gi√¢y ‚âà 6 ph√∫t 20 gi√¢y ‚Üí c·ªông 6 ph√∫t
        minLabel.Text = "Ph√∫t treo: " .. totalMinutes
    end
end)

-- Anti-AFK ƒë∆°n gi·∫£n
spawn(function()
    while true do
        task.wait(math.random(12, 35))
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            local hum = player.Character.Humanoid
            hum:Move(Vector3.new(math.random(-1,1)*0.8, 0, math.random(-1,1)*0.8))
            task.wait(0.08)
            hum.Jump = true
        end
    end
end)

print("Anti-AFK Menu Loaded - Circle size 20 & Lag Fix fixed!")
