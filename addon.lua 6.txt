-- Anti-AFK Script with Custom GUI for Roblox
-- Updated: Anti-AFK ch√≠nh x√°c (ngƒÉn kick sau 20 ph√∫t kh√¥ng ho·∫°t ƒë·ªông)

local player = game.Players.LocalPlayer
local gui = Instance.new("ScreenGui")
gui.Parent = player:WaitForChild("PlayerGui")
gui.Name = "AntiAFKGui"
gui.ResetOnSpawn = false

-- Outer Circular Button (size 20)
local outerButton = Instance.new("ImageButton")
outerButton.Size = UDim2.new(0, 20, 0, 20)
outerButton.Position = UDim2.new(0.5, -10, 0.5, -10)
outerButton.BackgroundColor3 = Color3.fromRGB(200, 200, 255)
outerButton.BackgroundTransparency = 0.4
outerButton.BorderSizePixel = 0
outerButton.AutoButtonColor = false
outerButton.Parent = gui

local outerCorner = Instance.new("UICorner")
outerCorner.CornerRadius = UDim.new(1, 0)
outerCorner.Parent = outerButton

-- Inner Menu
local innerMenu = Instance.new("Frame")
innerMenu.Size = UDim2.new(0, 220, 0, 320)
innerMenu.Position = UDim2.new(0.5, -110, 0.5, -160)
innerMenu.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
innerMenu.BackgroundTransparency = 0.15
innerMenu.Visible = false
innerMenu.Parent = gui

local innerCorner = Instance.new("UICorner")
innerCorner.CornerRadius = UDim.new(0, 20)
innerCorner.Parent = innerMenu

-- Title
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Anti-AFK System ü¶ãü´ôüêøÔ∏è"
titleLabel.TextColor3 = Color3.fromRGB(220, 220, 255)
titleLabel.TextSize = 22
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.Parent = innerMenu

-- Countdown Frame (ƒë·∫øm ng∆∞·ª£c 20 ph√∫t)
local countdownFrame = Instance.new("Frame")
countdownFrame.Size = UDim2.new(0.8, 0, 0, 45)
countdownFrame.Position = UDim2.new(0.1, 0, 0.18, 0)
countdownFrame.BackgroundColor3 = Color3.fromRGB(90, 90, 120)
countdownFrame.Parent = innerMenu

local cdCorner = Instance.new("UICorner")
cdCorner.CornerRadius = UDim.new(0, 8)
cdCorner.Parent = countdownFrame

local countdownLabel = Instance.new("TextLabel")
countdownLabel.Size = UDim2.new(1, 0, 1, 0)
countdownLabel.BackgroundTransparency = 1
countdownLabel.TextColor3 = Color3.fromRGB(255, 240, 180)
countdownLabel.TextSize = 24
countdownLabel.Text = "20:00"
countdownLabel.Parent = countdownFrame

-- Session Timer
local sessionFrame = Instance.new("Frame")
sessionFrame.Size = UDim2.new(0.8, 0, 0, 35)
sessionFrame.Position = UDim2.new(0.1, 0, 0.32, 0)
sessionFrame.BackgroundColor3 = Color3.fromRGB(120, 120, 150)
sessionFrame.Parent = innerMenu

local sessionLabel = Instance.new("TextLabel")
sessionLabel.Size = UDim2.new(1, 0, 1, 0)
sessionLabel.BackgroundTransparency = 1
sessionLabel.TextColor3 = Color3.fromRGB(255, 255, 200)
sessionLabel.TextSize = 20
sessionLabel.Text = "Phi√™n: 00:00:00"
sessionLabel.Parent = sessionFrame

-- Status Label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, 0, 0, 30)
statusLabel.Position = UDim2.new(0, 0, 0.42, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.fromRGB(180, 255, 180)
statusLabel.TextSize = 18
statusLabel.Text = "Tr·∫°ng th√°i: Ho·∫°t ƒë·ªông ‚úì"
statusLabel.Parent = innerMenu

-- Toggle Anti-AFK
local toggleFrame = Instance.new("TextButton")
toggleFrame.Size = UDim2.new(0.8, 0, 0, 40)
toggleFrame.Position = UDim2.new(0.1, 0, 0.52, 0)
toggleFrame.BackgroundColor3 = Color3.fromRGB(0, 200, 80) -- Xanh = b·∫≠t
toggleFrame.TextColor3 = Color3.fromRGB(0, 0, 0)
toggleFrame.Text = "Anti-AFK: B·∫≠t"
toggleFrame.TextSize = 20
toggleFrame.Font = Enum.Font.SourceSansSemibold
toggleFrame.Parent = innerMenu

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 10)
toggleCorner.Parent = toggleFrame

-- Lag Fix Toggle
local lagToggleFrame = Instance.new("TextButton")
lagToggleFrame.Size = UDim2.new(0.8, 0, 0, 40)
lagToggleFrame.Position = UDim2.new(0.1, 0, 0.65, 0)
lagToggleFrame.BackgroundColor3 = Color3.fromRGB(90, 90, 120) -- X√°m = t·∫Øt
lagToggleFrame.TextColor3 = Color3.fromRGB(255, 255, 255)
lagToggleFrame.Text = "Fix Lag: T·∫Øt"
lagToggleFrame.TextSize = 20
lagToggleFrame.Font = Enum.Font.SourceSansSemibold
lagToggleFrame.Parent = innerMenu

local lagCorner = Instance.new("UICorner")
lagCorner.CornerRadius = UDim.new(0, 10)
lagCorner.Parent = lagToggleFrame

-- Bi·∫øn
local antiAFKEnabled = true
local lagFixEnabled = false
local lastActivityTime = tick()
local sessionStartTime = tick()
local kickTimer = 20 * 60 -- 20 ph√∫t = 1200 gi√¢y
local currentTimer = kickTimer

-- L∆∞u setting g·ªëc
local originalSettings = {
    QualityLevel = settings().Rendering.QualityLevel,
    Brightness = game.Lighting.Brightness,
    GlobalShadows = game.Lighting.GlobalShadows,
    Technology = game.Lighting.Technology,
    FogEnd = game.Lighting.FogEnd,
    FOV = workspace.CurrentCamera.FieldOfView,
}

-- H√†m k√©o th·∫£
local function makeDraggable(frame)
    local dragging, dragInput, dragStart, startPos
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

makeDraggable(outerButton)
makeDraggable(innerMenu)

-- Toggle menu
outerButton.MouseButton1Click:Connect(function()
    innerMenu.Visible = not innerMenu.Visible
end)

-- Toggle Anti-AFK
toggleFrame.MouseButton1Click:Connect(function()
    antiAFKEnabled = not antiAFKEnabled
    
    if antiAFKEnabled then
        toggleFrame.BackgroundColor3 = Color3.fromRGB(0, 200, 80) -- Xanh = b·∫≠t
        toggleFrame.Text = "Anti-AFK: B·∫≠t"
        statusLabel.Text = "Tr·∫°ng th√°i: Ho·∫°t ƒë·ªông ‚úì"
        statusLabel.TextColor3 = Color3.fromRGB(180, 255, 180)
    else
        toggleFrame.BackgroundColor3 = Color3.fromRGB(220, 40, 40) -- ƒê·ªè = t·∫Øt
        toggleFrame.Text = "Anti-AFK: T·∫Øt"
        statusLabel.Text = "Tr·∫°ng th√°i: Nguy hi·ªÉm ‚úó"
        statusLabel.TextColor3 = Color3.fromRGB(255, 120, 120)
    end
end)

-- Toggle Fix Lag
lagToggleFrame.MouseButton1Click:Connect(function()
    lagFixEnabled = not lagFixEnabled
    
    if lagFixEnabled then
        lagToggleFrame.BackgroundColor3 = Color3.fromRGB(0, 150, 255) -- Xanh d∆∞∆°ng = b·∫≠t
        lagToggleFrame.Text = "Fix Lag: B·∫≠t"
        
        -- √Åp d·ª•ng fix lag
        settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
        game.Lighting.Brightness = 1
        game.Lighting.GlobalShadows = false
        game.Lighting.Technology = Enum.Technology.Compatibility
        game.Lighting.FogEnd = math.huge
        workspace.CurrentCamera.FieldOfView = 55
        
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") then
                v.Enabled = false
            end
        end
    else
        lagToggleFrame.BackgroundColor3 = Color3.fromRGB(90, 90, 120) -- X√°m = t·∫Øt
        lagToggleFrame.Text = "Fix Lag: T·∫Øt"
        
        -- Reset v·ªÅ g·ªëc
        settings().Rendering.QualityLevel = originalSettings.QualityLevel
        game.Lighting.Brightness = originalSettings.Brightness
        game.Lighting.GlobalShadows = originalSettings.GlobalShadows
        game.Lighting.Technology = originalSettings.Technology
        game.Lighting.FogEnd = originalSettings.FogEnd
        workspace.CurrentCamera.FieldOfView = originalSettings.FOV
        
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") then
                v.Enabled = true
            end
        end
    end
end)

-- H√†m format th·ªùi gian
local function formatTime(seconds)
    local minutes = math.floor(seconds / 60)
    local secs = math.floor(seconds % 60)
    return string.format("%02d:%02d", minutes, secs)
end

local function formatSessionTime(seconds)
    local hours = math.floor(seconds / 3600)
    local minutes = math.floor((seconds % 3600) / 60)
    local secs = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", hours, minutes, secs)
end

-- H√†m ph√°t hi·ªán ho·∫°t ƒë·ªông ng∆∞·ªùi d√πng
local function simulateActivity()
    if not antiAFKEnabled then return end
    
    -- Reset timer khi c√≥ ho·∫°t ƒë·ªông
    currentTimer = kickTimer
    lastActivityTime = tick()
    
    -- Th·ª±c hi·ªán h√†nh ƒë·ªông ch·ªëng AFK
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        local hum = player.Character.Humanoid
        
        -- Di chuy·ªÉn nh·∫π
        local moveDirection = Vector3.new(
            math.random(-1, 1) * 0.5,
            0,
            math.random(-1, 1) * 0.5
        )
        
        -- Ch·ªâ di chuy·ªÉn n·∫øu kh√¥ng ƒëang ng·ªìi ho·∫∑c n·∫±m
        if hum.Sit == false and hum.PlatformStand == false then
            hum:Move(moveDirection, true)
        end
        
        -- Nh·∫£y ng·∫´u nhi√™n (30% c∆° h·ªôi)
        if math.random(1, 100) <= 30 then
            hum.Jump = true
        end
        
        -- Xoay camera nh·∫π
        local cam = workspace.CurrentCamera
        if cam then
            cam.CFrame = cam.CFrame * CFrame.Angles(
                0,
                math.rad(math.random(-5, 5)) * 0.1,
                0
            )
        end
    end
    
    -- G·ª≠i input ·∫£o
    game:GetService("VirtualInputManager"):SendKeyEvent(
        true,
        Enum.KeyCode.Space,
        false,
        game
    )
    task.wait(0.05)
    game:GetService("VirtualInputManager"):SendKeyEvent(
        false,
        Enum.KeyCode.Space,
        false,
        game
    )
end

-- Timer ch√≠nh
game:GetService("RunService").Heartbeat:Connect(function(dt)
    -- C·∫≠p nh·∫≠t session timer
    local sessionElapsed = tick() - sessionStartTime
    sessionLabel.Text = "Phi√™n: " .. formatSessionTime(sessionElapsed)
    
    -- X·ª≠ l√Ω anti-AFK timer
    if antiAFKEnabled then
        currentTimer = currentTimer - dt
        
        -- Ki·ªÉm tra n·∫øu s·∫Øp h·∫øt th·ªùi gian (d∆∞·ªõi 1 ph√∫t)
        if currentTimer <= 60 then
            countdownLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            statusLabel.Text = "Chu·∫©n b·ªã ho·∫°t ƒë·ªông..."
            statusLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
        else
            countdownLabel.TextColor3 = Color3.fromRGB(255, 240, 180)
        end
        
        -- C·∫≠p nh·∫≠t countdown
        countdownLabel.Text = formatTime(currentTimer)
        
        -- T·ª± ƒë·ªông k√≠ch ho·∫°t ho·∫°t ƒë·ªông khi c√≤n 30 gi√¢y
        if currentTimer <= 30 then
            simulateActivity()
        end
        
        -- Ho·∫°t ƒë·ªông ƒë·ªãnh k·ª≥ m·ªói 2-4 ph√∫t
        local timeSinceLastActivity = tick() - lastActivityTime
        if timeSinceLastActivity >= math.random(120, 240) then -- 2-4 ph√∫t
            simulateActivity()
        end
    else
        countdownLabel.Text = "--:--"
        countdownLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    end
end)

-- Ho·∫°t ƒë·ªông ng·∫´u nhi√™n m·∫°nh h∆°n m·ªói 5-8 ph√∫t
spawn(function()
    while true do
        task.wait(math.random(300, 480)) -- 5-8 ph√∫t
        
        if antiAFKEnabled and player.Character and player.Character:FindFirstChild("Humanoid") then
            local hum = player.Character.Humanoid
            
            -- Ho·∫°t ƒë·ªông m·∫°nh h∆°n
            for i = 1, 3 do
                hum:Move(Vector3.new(
                    math.random(-1, 1) * 0.8,
                    0,
                    math.random(-1, 1) * 0.8
                ), true)
                task.wait(0.1)
                hum.Jump = true
                task.wait(0.1)
            end
        end
    end
end)

-- K·∫øt n·ªëi s·ª± ki·ªán ng∆∞·ªùi d√πng th·∫≠t
game:GetService("UserInputService").InputBegan:Connect(function()
    lastActivityTime = tick()
    if antiAFKEnabled then
        currentTimer = kickTimer
    end
end)

print("Anti-AFK System Loaded - Ch·ªëng kick sau 20 ph√∫t kh√¥ng ho·∫°t ƒë·ªông!")
